services:
  openvscode-server:
    image: gitpod/openvscode-server
    stdin_open: true
    tty: true
    init: true
    volumes:
      - /alist/uos/docker/vscode/data:/home/workspace:cached
    networks:
      - o3
    deploy:
      mode: replicated
      replicas: 1
      labels:
        - traefik.enable=true
        - traefik.http.routers.vscode-r.rule=Host(`vscode.131.186.17.46.nip.io`)
        - traefik.http.routers.vscode-r.entrypoints=websecure
        - traefik.http.routers.vscode-r.priority=1
        - traefik.http.routers.vscode-r.tls.certresolver=letsencryptresolver
        - traefik.http.routers.vscode-r.service=vscode-s
        - traefik.http.routers.vscode-r.headers.customrequestheaders.X-Forwarded-Proto=https
        - traefik.http.services.vscode-s.loadbalancer.server.port=3000
        - traefik.http.services.vscode-s.loadbalancer.passHostHeader=true
        - traefik.http.services.vscode-s.loadbalancer.server.scheme=https
networks:
  o3:
    external: true
